<!DOCTYPE html>
<html>
	<head lang="en">
	    <meta charset="UTF-8">
	    <!-- 优先使用 IE 最新版本和 Chrome -->
	    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
	    <!-- 为移动设备添加 viewport -->
	    <meta name="viewport" content="width=device-width,initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
	    <!-- 添加到主屏后的标题（iOS 6 新增） -->
	    <meta name="apple-mobile-web-app-title" content="">
	    <!-- 是否启用 WebApp 全屏模式，删除苹果默认的工具栏和菜单栏 -->
	    <meta name="apple-mobile-web-app-capable" content="yes"/>
	    <!-- 设置苹果工具栏颜色 -->
	    <meta name="apple-mobile-web-app-status-bar-style" content="black"/>
	    <!-- 添加智能 App 广告条 Smart App Banner（iOS 6+ Safari） -->
	    <meta name="apple-itunes-app" content="app-id=myAppStoreID, affiliate-data=myAffiliateData, app-argument=myURL">
	    <!-- 忽略页面中的数字识别为电话，忽略email识别 -->
	    <meta name="format-detection" content="telphone=no, email=no"/>
	    <!--下面三个是清除缓存 微信浏览器缓存严重又无刷新；这个方法调试的时候很方便-->
	    <meta http-equiv="Pragma" content="no-cache">
	    <meta http-equiv="Cache-Control" content="no-cache">
	    <meta http-equiv="Expires" content="0">
	    <title></title>
	    <link href="{% static 'css/mui.min.css' %}" rel="stylesheet"/>
	    <link rel="stylesheet" type="text/css" href="{% static 'css/common.css' %}"/>
	    <link rel="stylesheet" type="text/css" href="{% static 'css/m_account_coupon.css' %}"/>
	
	</head>
	<body>
		<header id="header" class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title">优惠券管理</h1>
		</header>
		<div class="mui-content">
			<!--选项卡部分-->
			<div id="task_slider" class="mui-slider mui-fullscreen">
				<div class="mui-slider-indicator mui-segmented-control mui-segmented-control-inverted">
					<a class="mui-control-item" href="#item1">使用券</a>
		            <a class="mui-control-item" href="#item2">加息券</a>
		            <a class="mui-control-item" href="#item3">现金券</a>
		            <a class="mui-control-item" href="#item4">兑换记录</a>
				</div>
				<div id="sliderProgressBar" class="mui-slider-progress-bar mui-col-xs-3"></div>
				<div class="mui-slider-group">
					<div id="item1" class="mui-slider-item mui-control-content mui-active">
						<div id="scroll1" class="mui-scroll-wrapper">
							<div class="mui-scroll">
								<ul class="mui-table-view">
								</ul>
							</div>
						</div>
					</div>
					<div id="item2" class="mui-slider-item mui-control-content">
						<div id="scroll1" class="mui-scroll-wrapper">
							<div class="mui-scroll">
								<ul class="mui-table-view">
								</ul>
							</div>
						</div>
					</div>
					<div id="item3" class="mui-slider-item mui-control-content">
						<div id="scroll1" class="mui-scroll-wrapper">
							<div class="mui-scroll">
								<ul class="mui-table-view">
								</ul>
							</div>
						</div>
					</div>
					<div id="item4" class="mui-slider-item mui-control-content">
						<div id="scroll1" class="mui-scroll-wrapper">
							<div class="mui-scroll">
								<ul class="list-box mui-table-view">
								</ul>
							</div>
						</div>
					</div>
				</div>

			</div>

		</div>
		<!--底部导航-->
		<script>
			var get_user_coupon_url = "{% url 'user_coupon_json' %}";
			mui.init({
				swipeBack: true //启用右滑关闭功能
			});

			(function($) {
				//阻尼系数
				var deceleration = mui.os.ios?0.003:0.0009;
				$('.mui-scroll-wrapper').scroll({
					bounce: true,
					indicators: true, //是否显示滚动条
					deceleration:deceleration
				});
				$.ready(function() {
					//循环初始化所有上拉加载
					$.each(document.querySelectorAll('.mui-slider-group .mui-scroll'), function(index, pullRefreshEl) {
						var count = 0;
						$(pullRefreshEl).pullToRefresh({
							up: {
								auto:true,
								callback: function() {
									var self = this;
									var ul = self.element.querySelector('.mui-table-view');
									get_finance_list(this,ul,count++,index);
								//		ul.appendChild(createFragment(ul, index, 5));
									//	self.endPullUpToRefresh(true);
								}
							}
						});
					});

					function get_finance_list(obj,ul,n,index){
						mui.ajax(get_task_url,{
							data:{
								count:n,
								type:index,
							},
							dataType:'json',//服务器返回json格式数据
							type:'get',//HTTP请求类型
							timeout:10000,//超时时间设置为10秒；
//							headers:{'Content-Type':'application/json'},
							success:function(data){
								if (!data.length){
									obj.endPullUpToRefresh(true);
								}
								else {
									obj.endPullUpToRefresh(false);//参数为true代表没有更多数据了。
									var table = document.body.querySelector('.mui-table-view');
//									var cells = document.body.querySelectorAll('.mui-table-view-cell');
									for (var i in data) {
										var wel = data[i];
										var li = document.createElement('li');
										li.className = 'mui-table-view-cell';
										li.innerHTML = '<a href="' + wel.url + '"><img src="' +
											wel.picurl + '" /><div class="li-info"><h6>' + wel.title +
											'</h6><span class="s1">' + wel.provider +
											'</span><span class="s2"><number>' + wel.view_count +
											'</number></span><span class="s3"><number>' + wel.time +
											'</number></span></div></a>';
										ul.appendChild(li);
									}
								}
							},
							error:function(xhr,type,errorThrown){
								alert(type);
							}
						});
					}
				});
			})(mui);
		</script>
    
    
	</body>
</html>
